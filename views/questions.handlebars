 
<script id="questionsTemplate" type="text/x-handlebars-template">
\{{#each this}}
 <div class ="topic">
 	<button type="button" disabled="disabled" class="btn btn-default btn-sm">\{{num_ans}} replies</button>
 	<button type="button" disabled="disabled" class="btn btn-default btn-sm">\{{timestamp}} seconds</button>
 	<button type="button" class="btn btn-link"><a href="/questions/\{{{id}}}">\{{title}}</a></button>
 </div>
\{{/each}}
</script>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#questionModal">Ask a question</button>
</br></br>
<div class="modal fade" id="questionModal" tabindex="-1" role="dialog"  aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Ask a question</h4>
			</div>
			<form id="questionForm">
				<div class="modal-body">
					<div class="form-group">
					<label class="control-label">Title:</label>
					<input type="text" class="form-control" name="title" id="title">
					</div>
					<div class="form-group">
					<label class="control-label">Body:</label>
					<textarea class="form-control" name="description" id="description"></textarea>
					</div>
					<span id="warning" class="text-danger text-center"> </span>  </br>                
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Create</button>
				</div>
			</form>
		</div>
	</div>
</div>  

<div class="main"></div>

 <script>
	function formValidation(){
		var title = document.getElementById("title").value;
		var desc= document.getElementById("description").value;

		var str1 = " ";
		if (title == ""|| title.length < 5 || desc =="" || desc.length < 5) {
			str = "*These fields are required with 5 minimum characters";
			var warning = document.getElementById("warning");
			warning.firstChild.nodeValue = str;
			return false;
		}
		else {
			str = " ";
			var warning = document.getElementById("warning");
			warning.firstChild.nodeValue = str;

		}
		return true;
	}

 	$(document).ready(function() {
 		questionsTemplate = Handlebars.compile($('#questionsTemplate').html());

 		function getQuestions() {
	 		$.ajax({
		        url: '/api/questions',
		        dataType: 'json',
		        method: 'get',
		        success: function(data) {
		        	for (var i =data.length-1; i >=0; i--) {
		        		data[i].timestamp = 300 - Math.round((new Date().getTime() - data[i].timestamp)/1000);
		        	}
		          	$('.main').html(questionsTemplate(data));  	
	    		}
	    	});
	 	}

 		getQuestions();
 		setInterval(function() {
			getQuestions();
		}, 1000);


 		
		$('#questionForm').on('submit', function(evt) {
			//cancel the default action
			evt.preventDefault();
			if (formValidation()) {
				$.ajax({
					url: '/api/questions',
					dataType: 'json',
					method: 'post',
					contentType: 'application/x-www-form-urlencoded',
					data: $('#questionForm').serialize(),
					success: function(data) {
						$('.main').html(questionsTemplate(data)); 
						$('#questionModal').modal('hide');
						$("#questionForm").get(0).reset();
					}
				});
			}
		});   
 	});

 </script>